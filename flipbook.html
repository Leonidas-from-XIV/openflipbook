<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC
    "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <title>Flipbook</title>
    <style type="text/css">
      body {
	  background-color: black;
	  color: white;
      }

      .ui-effects-transfer {
	  border: 2px dotted gray;
      }
    </style>
    <script type="text/javascript" src="jquery.js"></script>    
    <script type="text/javascript" src="jquery-ui.js"></script>
    <script type="text/javascript" src="jquery.event.special.gesture.js"></script>    
    <script type="text/javascript" src="jquery.gestureable.js"></script>    
    <script type="text/javascript">
      /* Code to do some fancy book-like effects
       */

       /* a closure-based class */
       var ImageManager = function (images) {
	   var self = this;
	   var currentPage = 0;

	   self.getCurrentPages = function () {
	       return [images[currentPage], 
		       images[currentPage+1]];
	   };

	   self.turnNext = function () {
	       currentPage += 2;
	       return self.getCurrentPages();
	   };

	   self.turnPrevious = function () {
	       currentPage -= 2;
	       return self.getCurrentPages();
	   };
       };

       function style_element(element) {
	  element.css('background-color', 'black');
          element.css('width', '900px');
	  element.css('height', '650px');
	  element.css('border', '2px dashed white');
      }

      function small_gesture(event) {
	  /* called in mousedown of small images */
	  var container = $(event.target).closest('div');
	  switch (event.gesture) {
	  case 'U':
	  case 'D':
	      container.data('left').hide();
	      container.data('right').hide();
	      container.data('spacer').hide();
	      container.data('zoomed').show('clip');
	  }
      }

      function large_gesture(event) {
	  var container = $(event.target).closest('div');
	  switch (event.gesture) {
	  case 'U':
	  case 'D':
	      $(event.target).hide();
	      container.data('spacer').show();
	      container.data('left').show();
	      container.data('right').show();
	  }
      }

      function disable_scroll(event) {
	  /* Simply disables the dragging of elements */
	  return false;
      }

      function flipbook(element, images) {
	  var manager = new ImageManager(images);
	  console.log(manager.getCurrentPages());
	  console.log(manager.turnNext());

	  // apply the style
	  style_element(element);

	  // create a spacer div and attach it
	  var spacer = $('<div class="spacer"></div>');
	  spacer.css('height', '162px');
	  element.data('spacer', spacer);
	  element.append(spacer);

	  var zoomed = $('<img src="image_01_large.jpg" />');
	  zoomed.gestureable();
	  zoomed.mouseup(large_gesture).
	  mousedown(disable_scroll).
	  hide();

	  element.data('zoomed', zoomed);
	  element.append(zoomed);

	  // create the images
	  var left = $('<img src="image_01_small.jpg" />');
	  var right = $('<img src="image_02_small.jpg" />');
	  element.data('left', left);
	  element.data('right', right);

	  $([left, right]).each(function (key, value) {
	      // enable gestures
	      value.gestureable();
	      value.mouseup(small_gesture);
	      value.mousedown(disable_scroll);
	      // add to the display
	      element.append(value);
	  });
      }

      $(document).ready(function () {
	  flipbook($('#flipbook'),
		   ['image_01', 'image_02', 'image_03', 'image_04',
		    'image_05', 'image_06', 'image_07', 'image_08',
		    'image_09', 'image_10', 'image_11', 'image_12',
		    'image_13', 'image_14', 'image_15']);
	});
    </script>
  </head>
  <body>
    <p>This is this flipbook</p>
    <div id="flipbook"></div>
  </body>
</html>
